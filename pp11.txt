import torch
import torch.nn as nn
import torch.optim as optim
import numpy as np
import matplotlib.pyplot as plt

X = torch.randn(100, 1) * 10
y = 3 * X + 7 + torch.randn(100, 1) * 2

class LinearRegressionModel(nn.Module):
    def __init__(self):
        super(LinearRegressionModel, self).__init__()
        self.linear = nn.Linear(1, 1)
    
    def forward(self, x):
        return self.linear(x)

model = LinearRegressionModel()
criterion = nn.MSELoss()
optimizer = optim.SGD(model.parameters(), lr=0.01)

losses = []
epochs = 100

for epoch in range(epochs):
    optimizer.zero_grad()
    
    predictions = model(X)
    loss = criterion(predictions, y)
    
    loss.backward()
    
    optimizer.step()
    
    losses.append(loss.item())
    
    if (epoch + 1) % 10 == 0:
        print(f'Epoch [{epoch+1}/{epochs}], Loss: {loss.item():.4f}')

print(f'\nLearned parameters:')
for name, param in model.named_parameters():
    print(f'{name}: {param.data}')

print(f'\nGradients:')
for name, param in model.named_parameters():
    if param.grad is not None:
        print(f'{name}.grad: {param.grad}')

with torch.no_grad():
    predicted = model(X).numpy()

plt.figure(figsize=(10, 6))
plt.scatter(X.numpy(), y.numpy(), label='Actual data')
plt.plot(X.numpy(), predicted, 'r-', label='Fitted line')
plt.xlabel('X')
plt.ylabel('y')
plt.legend()
plt.title('Linear Regression with PyTorch')
plt.savefig('linear_regression.png')
print('\nPlot saved as linear_regression.png')

plt.figure(figsize=(10, 6))
plt.plot(losses)
plt.xlabel('Epoch')
plt.ylabel('Loss')
plt.title('Training Loss')
plt.savefig('training_loss.png')
print('Loss plot saved as training_loss.png')
